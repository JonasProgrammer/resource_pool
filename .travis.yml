language: cpp
os: linux
sudo: true
dist: xenial
cache:
  ccache: true
  directories:
  - ${HOME}/.ccache

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - clang++-5.0
    - g++-7
    - python-pip
    - libcurl4-openssl-dev
    - libelf-dev
    - libdw-dev

env:
  global:
  - LOCAL=${HOME}/.local
  - PATH=${LOCAL}/bin:${PATH}

before_script:
- cmake --version
- wget -O boost_1_66_0.tar.gz https://dl.bintray.com/boostorg/release/1.66.0/source/boost_1_66_0.tar.gz
- tar xzf boost_1_66_0.tar.gz
- cd boost_1_66_0
- ./bootstrap.sh --with-libraries=system,thread,context,coroutine
- mkdir build
- ./b2 --build-dir=build
- sudo ./b2 --build-dir=build install
- cd ${TRAVIS_BUILD_DIR}
- mkdir -p ${TRAVIS_BUILD_DIR}/build
- cd ${TRAVIS_BUILD_DIR}/build

matrix:
  include:
  - name: clang 5 release
    env:
    - CXX_COMPILER: clang++-5.0
    script:
    - ${TRAVIS_BUILD_DIR}/scripts/travis/build.sh
  - name: gcc 7 debug+coverage
    env:
    - CXX_COMPILER: g++-7
    script:
    - ${TRAVIS_BUILD_DIR}/scripts/travis/coverage.sh
    after_success:
    - bash <(curl -s https://codecov.io/bash)
